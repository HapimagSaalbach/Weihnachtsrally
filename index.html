<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Der letzte Weihnachtszauber ‚Äì Hapimag Saalbach</title>

<style>
:root{
  --rot: #b30000;
  --rot-hell: #d93434;
  --gruen: #0f4a2f;
  --text: #222;
  --karte: rgba(255,255,255,0.97);
  --radius: 22px;
  --shadow: 0 10px 40px rgba(0,0,0,0.22);
}

* { box-sizing: border-box; }

body{
  margin:0;
  font-family: system-ui, Arial, sans-serif;
  color:var(--text);
  min-height:100vh;

  /* üéÑ Scharfes Weihnachtsbild */
  background-image: url("christmas-background.jpg");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}

.wrap{
  width:min(950px,100%);
  margin:auto;
  padding:18px;
}

.card{
  background:var(--karte);
  padding:22px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  margin-top:20px;
}

/* ---------- HEADER ---------- */

.head{
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:12px;
  align-items:center;
}

.santa-mini{
  width:80px;
  border-radius:14px;
}

.title{
  margin:0;
  color:var(--rot);
  font-size:clamp(1.6rem,2vw,2rem);
}

.badge{
  display:inline-block;
  margin-top:4px;
  padding:4px 10px;
  background:#ffecec;
  color:var(--rot);
  border-radius:14px;
  font-size:.85rem;
  border:1px solid #ffb3b3;
}

/* ---------- BUTTONS ---------- */

button{
  cursor:pointer;
  padding:1rem 1.5rem;
  border-radius:14px;
  border:2px solid var(--rot);
  font-weight:700;
  font-size:1rem;
  transition:0.2s;
  background:var(--rot);
  color:white;
}

button.secondary{
  background:white;
  color:var(--rot);
}

button:hover{
  filter:brightness(1.15);
}

button:disabled{
  opacity:0.45;
  cursor:not-allowed;
}

/* ---------- INPUT ---------- */

label{
  font-weight:600;
  margin-top:1rem;
  display:block;
}

input{
  width:100%;
  padding:.9rem 1rem;
  margin-top:.3rem;
  border:2px solid #ffb3b3;
  border-radius:14px;
  font-size:1rem;
}

/* ---------- FEEDBACK ---------- */

.err{
  display:none;
  color:#b30000;
  font-weight:700;
  margin-top:.7rem;
}

.ok{
  display:none;
  background:#e8ffe8;
  border:2px solid #62c06c;
  padding:.9rem 1rem;
  margin-top:.9rem;
  border-radius:14px;
  color:#115b17;
  font-weight:700;
}

/* ---------- ORTS-BOX ---------- */

.loc{
  display:none;
  background:#fff7e6;
  border:2px solid #ffe0b3;
  padding:1rem;
  margin-top:1rem;
  border-radius:14px;
  font-weight:700;
}

/* ---------- FULL OVERLAYS ---------- */

.fullOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  backdrop-filter:blur(4px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
  padding:20px;
}

.box{
  width:min(900px,92%);
  max-height:92vh;
  background:white;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
}

.inner{
  padding:24px;
  text-align:center;
}

/* ---------- POPUP ---------- */

#letterPopup{
  display:none;
}

.popup-santa{
  max-width:240px;
  margin:auto;
  border-radius:16px;
}

/* ---------- PUZZLE ---------- */

#puzzleOverlay{
  display:none;
}

.puzzleBox{
  width:min(900px,92%);
  background:white;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:26px;
  text-align:center;
}

.puzzleSlots, .puzzleLetters{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
  margin-top:20px;
}

.slot{
  width:60px;
  height:60px;
  border:2px dashed #ffb3b3;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.7rem;
  font-weight:800;
  color:var(--rot);
  background:#fff6f6;
}

.letterTile{
  width:60px;
  height:60px;
  background:var(--rot);
  color:white;
  font-size:1.7rem;
  font-weight:800;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  user-select:none;
}

/* ---------- FOOTER ---------- */

.footer{
  margin-top:40px;
  text-align:center;
  color:#fff;
  text-shadow:0 0 8px rgba(0,0,0,0.6);
  font-size:0.9rem;
}

.footer img{
  width:80px;
  opacity:0.85;
}

/* MOBILE */
@media(max-width:600px){
  .santa-mini{ width:60px; }
  .slot, .letterTile{
    width:70px;
    height:70px;
  }
}
</style>
</head>
<body>
<!-- INTRO OVERLAY -->
<div id="introOverlay" class="fullOverlay">
  <div class="box">
    <div class="inner">
      <h2 class="introTitle">Der letzte Weihnachtszauber</h2>

      <!-- Weihnachtsmann gro√ü -->
      <img src="Weihnachtsmann.jpg" class="intro-santa" style="max-width:260px; border-radius:18px; margin-bottom:20px;">

      <p class="introText" style="text-align:left; line-height:1.55;">
        In der l√§ngsten Nacht des Winters liegt das alte Haus still im Schnee ‚Äì und doch scheint es zu atmen.
        Drinnen flackert ein schwaches Licht, als w√ºrde jemand warten.  
        Vor langer Zeit verga√ü das Christkind hier ein letztes Geschenk ‚Äì  
        eine Truhe, verschlossen mit einem Zahlencode, den selbst der Himmel nicht mehr kennt.  
        Seit jener Nacht ruht der Weihnachtszauber in ihr ‚Äì unerweckt, unerl√∂st.
        <br><br>
        Doch das Haus ist nicht stumm. Es fl√ºstert R√§tsel durch seine Flure,  
        l√§sst Schatten tanzen und Kerzen flackern, als wollten sie f√ºhren.  
        Wer genau hinh√∂rt, sp√ºrt, dass die Antworten √ºberall verborgen sind ‚Äì  
        im Knirschen des Schnees, im Wispern des Windes, in Zeichen, die nur im rechten Moment sichtbar werden.
        <br><br>
        Drei Ziffern √∂ffnen die Truhe. Zw√∂lf schwere R√§tsel f√ºhren dorthin.  
        Folge dem Ruf der Nacht, lausche den Hinweisen ‚Äì  
        und vielleicht wirst du das Geschenk finden, das das Christkind selbst vergessen hat.
      </p>

      <button id="readIntro" class="secondary">‚ñ∂Ô∏è Vorlesen</button>
      <audio id="introAudio" preload="auto" src="ElevenLabs_Text_to_Speech_audio.mp3"></audio>
    </div>

    <div class="inner" style="border-top:1px solid #eee;">
      <button id="startBtn" disabled style="display:none;">Weiter zur R√§tseltour ‚ú®</button>
    </div>
  </div>
</div>


<!-- POPUP: BUCHSTABE GEFUNDEN -->
<div id="letterPopup" class="fullOverlay" style="display:none;">
  <div class="box">
    <div class="inner">
      <img src="Weihnachtsmann.jpg" class="popup-santa">

      <h2 id="popupTitle">Gut gemacht! üéÑ‚≠ê</h2>
      <p id="popupText">Du hast eine geheime Spur gefunden!</p>
    </div>

    <div class="inner" style="border-top:1px solid #eee;">
      <button id="popupNextBtn">Weiter ‚ûú</button>
    </div>
  </div>
</div>


<!-- HAUPT-R√ÑTSEL -->
<main class="wrap">
  <section class="card" id="mainCard" style="display:none;">

    <header class="head">
      <img src="Weihnachtsmann.jpg" class="santa-mini">

      <div>
        <h1 class="title">Der letzte Weihnachtszauber</h1>
        <p class="sub">Finde alle 12 Buchstaben ‚Äì am Ende entsteht das L√∂sungswort</p>
        <span class="badge" id="badge"></span>
      </div>

      <img src="Weihnachtsmann.jpg" class="santa-mini">
    </header>

    <h2 id="riddleTitle">R√§tsel</h2>
    <p id="riddleText"></p>

    <label>Deine Antwort</label>
    <input id="answerInput" autocomplete="off" placeholder="Antwort eingeben‚Ä¶">

    <button id="checkAnswerBtn" style="margin-top:1rem;">Antwort pr√ºfen</button>

    <div class="err" id="errBox">Leider falsch ‚Äì versuch's nochmal!</div>
    <div class="ok" id="okBox">Richtig!</div>

    <div id="locBox" class="loc"></div>

    <div id="letterStep" style="display:none;">
      <label>Buchstabe vom Ort</label>
      <input id="letterInput" maxlength="1" placeholder="Buchstabe eingeben‚Ä¶">
    </div>
  </section>
</main>


<!-- PUZZLE OVERLAY -->
<div id="puzzleOverlay" class="fullOverlay" style="display:none;">
  <div class="puzzleBox">
    <h2>Das L√∂sungswort sortieren</h2>
    <p>Ziehe die Buchstaben in die richtige Reihenfolge.</p>

    <div class="puzzleSlots" id="puzzleSlots"></div>
    <div class="puzzleLetters" id="puzzleLetters"></div>
  </div>
</div>


<!-- FINALE -->
<div id="finalOverlay" class="fullOverlay" style="display:none;">
  <div class="box">
    <div class="inner">
      <img src="Weihnachtsmann.jpg" class="intro-santa">

      <h2 class="introTitle">Du hast es geschafft! üéÅ‚ú®</h2>

      <p>
        Du hast alle Buchstaben richtig sortiert!<br><br>
        Gehe nun zur Rezeption und sage das L√∂sungswort.<br>
        Das Christkind z√§hlt auf dich! ‚ú®
      </p>
    </div>

    <div class="inner" style="border-top:1px solid #eee;">
      <button onclick="location.reload()">Nochmal spielen</button>
    </div>
  </div>
</div>


<!-- FOOTER -->
<div class="footer">
  <img src="Hapimag Logo.png"><br>
  Hapimag Saalbach ‚Äì Weihnachtsrally
</div>
<script>

/* ============================================================
   INTRO ‚Äì AUDIO + START BUTTON
============================================================ */
const introAudio = document.getElementById("introAudio");
const readIntro = document.getElementById("readIntro");
const startBtn = document.getElementById("startBtn");

let introIsPlaying = false;

readIntro.addEventListener("click", async ()=>{
  startBtn.style.display = "none";

  if(!introIsPlaying){
    introAudio.currentTime = 0;
    await introAudio.play();
    introIsPlaying = true;
    readIntro.textContent = "‚è∏Ô∏è Pause";
  } else {
    introAudio.pause();
    introIsPlaying = false;
    readIntro.textContent = "‚ñ∂Ô∏è Vorlesen";
  }
});

introAudio.addEventListener("ended", ()=>{
  introIsPlaying = false;
  readIntro.textContent = "‚ñ∂Ô∏è Vorlesen";

  startBtn.style.display = "inline-block";
  startBtn.disabled = false;
});

startBtn.addEventListener("click", ()=>{
  document.getElementById("introOverlay").style.display="none";
  document.getElementById("mainCard").style.display="block";
  loadStation(1);
});


/* ============================================================
   WEIHNACHTS-R√ÑTSEL (12 STATIONEN)
============================================================ */
const riddles = [
  null,

  {
    q:"Vier Kerzen auf einem Kranz beginnen still die Weihnachtszeit. Wie nennt man ihn?",
    a:["adventskranz","der adventskranz","advents-kranz"]
  },
  {
    q:"Ein Zweig, der K√ºsse bringt. Wie hei√ü ich?",
    a:["mistel","mistelzweig","der mistelzweig"]
  },
  {
    q:"Ich ziehe den Schlitten durch die Nacht. Wer bin ich?",
    a:["rentier","rentiere"]
  },
  {
    q:"Ich fliege √ºber Schnee, habe aber Kufen. Was bin ich?",
    a:["schlitten","rodel"]
  },
  {
    q:"Sternf√∂rmig, s√º√ü und zimtig ‚Äì welches Geb√§ck bin ich?",
    a:["zimtstern"]
  },
  {
    q:"Aus Honig und Gew√ºrzen, oft herzf√∂rmig ‚Äì was bin ich?",
    a:["lebkuchen","lebkuchenherz"]
  },
  {
    q:"Rote Bl√§tter, wei√üe Sternform ‚Äì wie hei√üt diese Pflanze?",
    a:["weihnachtsstern"]
  },
  {
    q:"Ein Kind im Stroh, mit Eltern daneben ‚Äì wie hei√üt diese Darstellung?",
    a:["krippe","weihnachtskrippe"]
  },
  {
    q:"Gl√§nzend, rund und am Baum h√§ngend ‚Äì wie hei√ü ich?",
    a:["christbaumkugel","weihnachtskugel"]
  },
  {
    q:"Am 6. Dezember steckt er S√º√ües in Stiefel. Wer bin ich?",
    a:["nikolaus","sankt nikolaus","st. nikolaus"]
  },
  {
    q:"Ein Stern, der den Weg zum Stall zeigte. Wie nennt man ihn?",
    a:["stern von bethlehem","bethlehemstern"]
  },
  {
    q:"Die Nacht, bevor es tagt ‚Äì der Abend der Bescherung. Wie hei√üt dieser Abend?",
    a:["heiligabend","heiliger abend"]
  }
];


/* ============================================================
   ORTE + BUCHSTABEN F√úR ‚ÄûWINTERWUNDER‚Äú (12 Buchstaben)
============================================================ */
const stations = {
  1:{place:"B√ºcherecke", letter:"W"},
  2:{place:"Skikeller", letter:"U"},
  3:{place:"Honesty Shop", letter:"D"},
  4:{place:"M√ºllraum", letter:"N"},
  5:{place:"Sauna", letter:"E"},
  6:{place:"Oberstes Stockwerk", letter:"T"},
  7:{place:"Wohnungst√ºr 11", letter:"R"},
  8:{place:"Au√üeneingang Skikeller", letter:"R"},
  9:{place:"Weihnachtsbaum", letter:"I"},
  10:{place:"Wohnungst√ºr 35", letter:"W"},
  11:{place:"Heizkeller Eingang", letter:"E"},
  12:{place:"Rezeption", letter:"N"}
};

let currentStation = 1;
let collectedLetters = [];


/* ============================================================
   STATION LADEN
============================================================ */
function loadStation(n){

  currentStation = n;

  if(n > 12){
    startPuzzle();
    return;
  }

  document.getElementById("badge").textContent = `Station ${n} / 12`;
  document.getElementById("riddleText").textContent = riddles[n].q;

  document.getElementById("answerInput").value = "";
  document.getElementById("letterInput").value = "";
  document.getElementById("errBox").style.display = "none";
  document.getElementById("okBox").style.display = "none";
  document.getElementById("locBox").style.display = "none";
  document.getElementById("letterStep").style.display = "none";
}


/* ============================================================
   ANTWORT PR√úFEN
============================================================ */
document.getElementById("checkAnswerBtn").addEventListener("click", ()=>{

  const val = normalize(document.getElementById("answerInput").value);
  const correct = riddles[currentStation].a;

  const ok = correct.some(c => normalize(c) === val);

  if(!ok){
    document.getElementById("errBox").style.display="block";
    return;
  }

  document.getElementById("errBox").style.display="none";
  document.getElementById("okBox").style.display="block";

  const st = stations[currentStation];

  document.getElementById("locBox").style.display="block";
  document.getElementById("locBox").innerHTML =
    `üìç <b>Ort:</b> ${st.place}<br>Suche dort den Buchstaben!`;

  document.getElementById("letterStep").style.display="block";
});


/* ============================================================
   BUCHSTABE PR√úFEN ‚Üí POPUP
============================================================ */
document.getElementById("letterInput").addEventListener("input", ()=>{

  const val = document.getElementById("letterInput").value.trim().toUpperCase();
  const needed = stations[currentStation].letter;

  if(val === needed){

    collectedLetters.push(val);

    document.getElementById("popupTitle").textContent =
      `Super! üéÑ‚ú®`;

    document.getElementById("popupText").textContent =
      `Du hast den ${currentStation}. Buchstaben gefunden: ${needed}`;

    document.getElementById("letterPopup").style.display="flex";
  }
});


document.getElementById("popupNextBtn").addEventListener("click", ()=>{
  document.getElementById("letterPopup").style.display="none";
  loadStation(currentStation + 1);
});


/* ============================================================
   HILFSFUNKTION
============================================================ */
function normalize(s){
  return s.toLowerCase().trim()
    .replace(/√§/g,'ae')
    .replace(/√∂/g,'oe')
    .replace(/√º/g,'ue')
    .replace(/√ü/g,'ss');
}


/* ============================================================
   PUZZLE F√úR ‚ÄûWINTERWUNDER‚Äú
============================================================ */

let draggedTile = null;

function startPuzzle(){

  document.getElementById("mainCard").style.display="none";
  document.getElementById("puzzleOverlay").style.display="flex";

  const slots = document.getElementById("puzzleSlots");
  slots.innerHTML = "";

  for(let i=0; i < 12; i++){
    const box = document.createElement("div");
    box.className = "slot";
    box.dataset.index = i;

    box.addEventListener("dragover", allowDrop);
    box.addEventListener("drop", dropIntoSlot);

    slots.appendChild(box);
  }

  const letters = [...collectedLetters];
  letters.sort(()=> Math.random() - 0.5);

  const pool = document.getElementById("puzzleLetters");
  pool.innerHTML = "";

  letters.forEach(L => createTile(L, pool));

  pool.addEventListener("dragover", allowDrop);
  pool.addEventListener("drop", dropIntoPool);
}


function createTile(letter, parent){

  const t = document.createElement("div");
  t.className = "letterTile";
  t.textContent = letter;
  t.dataset.letter = letter;
  t.draggable = true;

  t.addEventListener("dragstart", dragStart);
  t.addEventListener("dragend", dragEnd);

  t.addEventListener("touchstart", touchStart, { passive:false });
  t.addEventListener("touchmove", touchMove, { passive:false });
  t.addEventListener("touchend", touchEnd, { passive:false });

  parent.appendChild(t);
}


function dragStart(){ draggedTile = this; this.style.opacity = "0.3"; }
function dragEnd(){ this.style.opacity = "1"; draggedTile = null; }

function allowDrop(e){ e.preventDefault(); }


function dropIntoSlot(e){
  e.preventDefault();
  if(!draggedTile) return;

  const letter = draggedTile.dataset.letter;

  if(this.textContent.trim() !== ""){
    const old = this.textContent.trim();
    createTile(old, document.getElementById("puzzleLetters"));
  }

  this.textContent = letter;
  draggedTile.remove();

  checkSolved();
}


function dropIntoPool(e){
  e.preventDefault();
  if(!draggedTile) return;

  const pool = document.getElementById("puzzleLetters");
  const letter = draggedTile.dataset.letter;

  document.querySelectorAll(".slot").forEach(slot=>{
    if(slot.textContent.trim() === letter){
      slot.textContent = "";
    }
  });

  createTile(letter, pool);
  draggedTile.remove();

  checkSolved();
}


/* TOUCH */
let touchTile = null;

function touchStart(e){
  e.preventDefault();
  touchTile = this;
  this.style.opacity = "0.4";
}

function touchMove(e){
  e.preventDefault();
  const touch = e.touches[0];
  const elem = document.elementFromPoint(touch.clientX, touch.clientY);
  document.querySelectorAll(".slot").forEach(s => s.style.outline = "");
  if(elem && elem.classList.contains("slot")){
    elem.style.outline = "3px solid #b91c1c";
  }
}

function touchEnd(e){
  if(!touchTile) return;

  touchTile.style.opacity = "1";
  const touch = e.changedTouches[0];
  const target = document.elementFromPoint(touch.clientX, touch.clientY);

  document.querySelectorAll(".slot").forEach(s => s.style.outline = "");

  draggedTile = touchTile;

  if(target && target.classList.contains("slot")){
    dropIntoSlot.call(target, e);
  } else {
    const pool = document.getElementById("puzzleLetters");
    dropIntoPool.call(pool, e);
  }

  touchTile = null;
}


/* ============================================================
   L√ñSUNG PR√úFEN
============================================================ */
function checkSolved(){

  const word = [...document.querySelectorAll(".slot")]
    .map(s => s.textContent.trim())
    .join("");

  if(word.length !== 12) return;

  if(word === "WINTERWUNDER"){

    setTimeout(()=>{
      document.getElementById("puzzleOverlay").style.display="none";
      document.getElementById("finalOverlay").style.display="flex";
    }, 300);

  } else {
    setTimeout(resetPuzzle, 500);
  }
}

function resetPuzzle(){

  const pool = document.getElementById("puzzleLetters");
  pool.innerHTML = "";

  document.querySelectorAll(".slot").forEach(slot=>{
    const L = slot.textContent.trim();
    if(L !== ""){
      createTile(L, pool);
      slot.textContent = "";
    }
  });
}

</script>
