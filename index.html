<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Die Suche nach dem letzten Weihnachtszauber ‚Äì Hapimag Saalbach</title>

  <style>
    :root{
      --wald: #0e2e1f;
      --moos: #1f6f49;
      --rot: #b11c1f;
      --hell: #fff;
      --bg: rgba(255,255,255,0.96);
      --radius: 22px;
      --shadow: 0 12px 40px rgba(0,0,0,0.28);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, Arial, sans-serif;
      background-image: url("Winterlandschaft.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color:#0e3020;
      min-height:100vh;
    }

    .wrap{
      width:min(980px,100%);
      margin:auto;
      padding:18px;
    }

    .card{
      background:var(--bg);
      padding:22px;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(3px);
    }

    /* ---------- HEADER ---------- */
    .head{
      display:grid;
      grid-template-columns:auto 1fr auto;
      gap:12px;
      align-items:center;
    }

    .logo-small{
      width:80px;
      opacity:0.85;
    }

    .tree-icon{
      width:60px;
    }

    h1.title{
      margin:0;
      color:var(--rot);
      font-size:clamp(1.7rem,2.4vw,2rem);
    }
    .sub{
      margin:2px 0 5px;
      font-size:.9rem;
      color:#255144;
    }
    .badge{
      display:inline-block;
      margin-top:4px;
      padding:4px 11px;
      background:#fff3f3;
      border-radius:14px;
      border:1px solid #ffd0d0;
      color:#b11c1f;
      font-size:.85rem;
    }

    /* ---------- BUTTONS ---------- */
    button{
      cursor:pointer;
      padding:1rem 1.4rem;
      border-radius:16px;
      background:var(--rot);
      border:2px solid var(--rot);
      color:white;
      font-weight:700;
      font-size:1rem;
      transition:.22s;
    }
    button:hover{
      filter:brightness(1.15);
    }
    button.secondary{
      background:white;
      color:var(--rot);
    }
    button:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    /* ---------- INPUTS ---------- */
    label{
      font-weight:600;
      margin-top:1.1rem;
      display:block;
    }

    input{
      width:100%;
      padding:.9rem 1rem;
      border:2px solid #c9e6d4;
      border-radius:14px;
      font-size:1rem;
      margin-top:.3rem;
      outline:none;
    }

    /* ---------- FEEDBACK ---------- */
    .err{
      display:none;
      color:#c62828;
      margin-top:.7rem;
      font-weight:700;
    }
    .ok{
      display:none;
      margin-top:.7rem;
      background:#e8ffe8;
      border:2px solid #62c06c;
      padding:.9rem 1rem;
      border-radius:16px;
      color:#115b17;
      font-weight:700;
    }

    .loc{
      display:none;
      background:#e6f7ef;
      border:2px solid #b7e8d0;
      padding:1rem;
      margin-top:1rem;
      border-radius:14px;
      font-weight:700;
    }

    /* ---------- OVERLAYS ---------- */
    .fullOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.55);
      backdrop-filter:blur(4px);
      z-index:1000;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .introBox, .popupBox, .puzzleBox{
      width:min(900px,92%);
      max-height:92vh;
      background:white;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
    }
    .introInner, .popupInner{
      padding:24px;
      text-align:center;
      overflow-y:auto;
    }
    .intro-zirbel{
      max-width:260px;
      margin:auto;
      display:block;
    }
    .popup-zirbel{
      max-width:300px;
      margin:auto;
      display:block;
    }

    /* ---------- PUZZLE ---------- */
    .puzzleSlots, .puzzleLetters{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:20px;
    }
    .slot, .letterTile{
      width:64px;
      height:64px;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.8rem;
      font-weight:800;
      user-select:none;
    }
    .slot{
      background:#f4fff8;
      border:2px dashed #bfe8cf;
      color:var(--moos);
    }
    .letterTile{
      background:var(--rot);
      color:white;
      cursor:grab;
    }
  </style>
</head>

<body>
<!-- INTRO-OVERLAY -->
<div id="introOverlay" class="fullOverlay">
  <div class="introBox">
    <div class="introInner">
      <img src="Weihnachtsmann.jpg" class="intro-zirbel">

      <h2 class="introTitle">Die Suche nach dem letzten Weihnachtszauber</h2>

      <p class="introText">
        In den verschneiten Bergen von Saalbach liegt ein altes Haus, das nur in der tiefsten Winterzeit erwacht.
        Dort verborgen ruht der letzte Weihnachtszauber ‚Äì verschlossen in einer Truhe, die nur durch 12 geheime Buchstaben ge√∂ffnet werden kann.
        Deine Aufgabe: L√∂se alle R√§tsel, finde die Orte im Resort und sammle die Buchstaben ein.
        Nur dann offenbart sich das gro√üe Geheimnis: das L√∂sungswort, das den Zauber befreit.
        Bist du bereit?
      </p>

      <button id="readBtn" class="secondary">‚ñ∂Ô∏è Vorlesen</button>
      <audio id="introAudio" preload="auto" src="ElevenLabs_Text_to_Speech_audio.mp3"></audio>
    </div>

    <div class="popupFooter">
      <button id="startBtn" disabled>Abenteuer beginnen ‚ú®</button>
    </div>
  </div>
</div>

<!-- POPUP NACH BUCHSTABEN -->
<div id="letterPopup" class="fullOverlay" style="display:none;">
  <div class="popupBox">
    <div class="popupInner">
      <img src="Weihnachtsmann.jpg" class="popup-zirbel">
      <h2>Super gemacht! üéÖ‚ú®</h2>
      <p>Du hast den n√§chsten magischen Buchstaben gefunden ‚Äì weiter so!</p>
    </div>

    <div class="popupFooter">
      <button id="popupNextBtn">Weiter ‚ûú</button>
    </div>
  </div>
</div>

<!-- HAUPT-R√ÑTSEL -->
<main class="wrap">
  <section class="card" id="mainCard" style="display:none;">

    <header class="head">
      <img src="Hapimag Logo.png" class="logo-small">

      <div>
        <h1 class="title">Winterliche R√§tseltour</h1>
        <p class="sub">Sammle alle 12 Buchstaben ‚Äì am Ende entsteht das L√∂sungswort!</p>
        <span class="badge" id="badge">Station</span>
      </div>

      <!-- Kleiner Weihnachtsbaum als Icon -->
      <svg class="tree-icon" viewBox="0 0 64 64">
        <polygon points="32,4 8,44 56,44" fill="#1f6f49"/>
        <polygon points="32,14 16,40 48,40" fill="#2a8e60"/>
        <rect x="27" y="44" width="10" height="14" fill="#8b5a2b"/>
      </svg>
    </header>

    <h2 id="riddleTitle">R√§tsel</h2>
    <p id="riddleText"></p>

    <label>Deine Antwort</label>
    <input id="answerInput" autocomplete="off" placeholder="Antwort eingeben‚Ä¶">

    <button id="checkAnswerBtn" style="margin-top:1rem;">Antwort pr√ºfen</button>

    <div class="err" id="errBox">Leider falsch ‚Äì versuch's nochmal!</div>
    <div class="ok" id="okBox">Richtig! Gut gemacht!</div>

    <div id="locBox" class="loc"></div>

    <div id="letterStep" style="display:none;">
      <label>Buchstabe vom Ort</label>
      <input id="letterInput" maxlength="1" placeholder="Buchstabe eingeben‚Ä¶">
    </div>

  </section>
</main>

<!-- PUZZLE -->
<div id="puzzleOverlay" class="fullOverlay" style="display:none;">
  <div class="puzzleBox">
    <h2>Buchstaben sortieren</h2>
    <p>Ziehe die 12 Buchstaben in die richtige Reihenfolge, um das L√∂sungswort zu bilden.</p>

    <div class="puzzleSlots" id="puzzleSlots"></div>
    <div class="puzzleLetters" id="puzzleLetters"></div>
  </div>
</div>

<!-- FINALE -->
<div id="finalOverlay" class="fullOverlay" style="display:none;">
  <div class="introBox">
    <div class="introInner" style="text-align:center;">
      <img src="Weihnachtsmann.jpg" class="intro-zirbel">

      <h2 class="introTitle">Du hast es geschafft! üéÑ</h2>

      <p>
        Du hast alle 12 Buchstaben richtig sortiert!<br><br>
        Gehe nun zur Rezeption und sage das L√∂sungswort.<br>
        Dort erwartet dich der letzte Weihnachtszauber! ‚ú®
      </p>
    </div>

    <div class="popupFooter">
      <button onclick="location.reload()">Nochmal spielen</button>
    </div>
  </div>
</div>
<script>
/* ============================================================
   VARIABLEN
============================================================ */
let currentStation = 1;
let collectedLetters = [];

/* Buchstaben in gemischter Reihenfolge f√ºr WINTERWUNDER */
const mixedLetters = ["N","W","E","R","U","I","D","T","R","N","E","W"];

/* ============================================================
   R√ÑTSEL (12 St√ºck)
============================================================ */
const riddles = [
  null,
  {q:"Ich z√§hle Wochen bis zur Nacht, die Hoffnung bringt in sanfter Pracht. Vier Kerzen brennen leis' und sacht ‚Äì wer bin ich?", a:["adventskranz","adventkranz","der adventskranz"]},
  {q:"Ein Zweig, der k√ºsst ‚Äì man glaubt es kaum. Wer drunter steht, erf√ºllt den Traum. Wie hei√ü ich?", a:["mistel","mistelzweig","der mistelzweig"]},
  {q:"Ich ziehe Schlitten durch die Nacht, mit gl√§nzend‚Äô Fell und stiller Pracht. Wer bin ich?", a:["rentier","rentiere"]},
  {q:"Ich fliege nicht, doch rase schnell. √úber wei√üen Schnee, ganz hell. Du sitzt auf mir ‚Äì wer bin ich?", a:["schlitten","rodel"]},
  {q:"Sechs Zacken, s√º√ü und sternenklar ‚Äì ich schmecke wunderbar. Wer bin ich?", a:["zimtstern","der zimtstern"]},
  {q:"Ich dufte warm nach Honig, fein. Mit Zuckerguss ‚Äì so soll es sein. Wie hei√ü ich?", a:["lebkuchen","lebkuchenherz"]},
  {q:"Rot im Winter, strahlend sch√∂n ‚Äì man sieht mich auf dem Fenster stehn. Wer bin ich?", a:["weihnachtsstern"]},
  {q:"Aus Holz gemacht und still verehrt: ein Kind, das man seit langem ehrt. Wie nennt man mich?", a:["krippe","weihnachtskrippe"]},
  {q:"Ich funkle hell und rund am Baum ‚Äì ein Glaskleid wie ein Zaubertraum. Wer bin ich?", a:["christbaumkugel","kugel","weihnachtskugel"]},
  {q:"Ich komme nur am 6. Tag, bring N√ºsse, Mandeln ‚Äì wie ich‚Äôs mag. Wer bin ich?", a:["nikolaus","sankt nikolaus"]},
  {q:"Ich leuchte √ºber Stall und Nacht, hab‚Äô K√∂nige zum Ziel gebracht. Wer bin ich?", a:["stern von bethlehem","bethlehemstern"]},
  {q:"Die Nacht, in der es jeder sagt: Heute wird Bescherung gemacht! Wie hei√ü ich?", a:["heiligabend","heiliger abend","christabend"]}
];

/* ============================================================
   ORTE + BUCHSTABEN (12)
============================================================ */
const stations = {
  1:{place:"B√ºcherecke", letter:mixedLetters[0]},
  2:{place:"Skikeller", letter:mixedLetters[1]},
  3:{place:"Honesty Shop", letter:mixedLetters[2]},
  4:{place:"M√ºllraum", letter:mixedLetters[3]},
  5:{place:"Sauna", letter:mixedLetters[4]},
  6:{place:"Oberstes Stockwerk", letter:mixedLetters[5]},
  7:{place:"Wohnungst√ºr 11", letter:mixedLetters[6]},
  8:{place:"Au√üeneingang Skikeller", letter:mixedLetters[7]},
  9:{place:"Weihnachtsbaum", letter:mixedLetters[8]},
  10:{place:"Wohnungst√ºr 35", letter:mixedLetters[9]},
  11:{place:"Eingang Heizkeller", letter:mixedLetters[10]},
  12:{place:"Rezeption", letter:mixedLetters[11]}
};

/* ============================================================
   INTRO / VORLESEN
============================================================ */
const audio = document.getElementById("introAudio");
const readBtn = document.getElementById("readBtn");
const startBtn = document.getElementById("startBtn");
let isPlaying = false;

startBtn.disabled = true;

readBtn.addEventListener("click", async ()=>{
  if(!isPlaying){
    audio.currentTime = 0;
    await audio.play();
    isPlaying = true;
    readBtn.textContent = "‚è∏Ô∏è Pause";
  } else {
    audio.pause();
    isPlaying = false;
    readBtn.textContent = "‚ñ∂Ô∏è Vorlesen";
  }
});

audio.addEventListener("ended", ()=>{
  isPlaying = false;
  readBtn.textContent = "‚ñ∂Ô∏è Vorlesen";
  startBtn.disabled = false;
});

/* Start */
startBtn.addEventListener("click", ()=>{
  document.getElementById("introOverlay").style.display="none";
  document.getElementById("mainCard").style.display="block";
  loadStation(1);
});

/* ============================================================
   STATION LADEN
============================================================ */
function loadStation(n){
  currentStation = n;

  if(n > 12){
    startPuzzle();
    return;
  }

  const r = riddles[n];

  document.getElementById("badge").textContent = `Station ${n} / 12`;
  document.getElementById("riddleTitle").textContent = "R√§tsel";
  document.getElementById("riddleText").textContent = r.q;

  document.getElementById("answerInput").value="";
  document.getElementById("letterInput").value="";
  document.getElementById("errBox").style.display="none";
  document.getElementById("okBox").style.display="none";
  document.getElementById("locBox").style.display="none";
  document.getElementById("letterStep").style.display="none";
}

/* ============================================================
   ANTWORT PR√úFEN
============================================================ */
document.getElementById("checkAnswerBtn").addEventListener("click", ()=>{
  const val = normalize(document.getElementById("answerInput").value);
  const correct = riddles[currentStation].a;

  const ok = correct.some(c => normalize(c) === val);

  if(!ok){
    document.getElementById("errBox").style.display="block";
    return;
  }

  document.getElementById("errBox").style.display="none";
  document.getElementById("okBox").style.display="block";

  const st = stations[currentStation];
  document.getElementById("locBox").style.display="block";
  document.getElementById("locBox").innerHTML =
    `üìç <b>Ort:</b> ${st.place}<br>Suche dort den Buchstaben!`;

  document.getElementById("letterStep").style.display="block";
});

/* ============================================================
   BUCHSTABE PR√úFEN
============================================================ */
document.getElementById("letterInput").addEventListener("input", ()=>{
  const val = document.getElementById("letterInput").value.trim().toUpperCase();
  const needed = stations[currentStation].letter;

  if(val === needed){
    collectedLetters.push(val);
    document.getElementById("letterPopup").style.display="flex";
  }
});

document.getElementById("popupNextBtn").addEventListener("click", ()=>{
  document.getElementById("letterPopup").style.display="none";
  loadStation(currentStation+1);
});

/* ============================================================
   NORMALISIEREN
============================================================ */
function normalize(s){
  return s.toLowerCase().trim()
    .replace(/√§/g,'ae')
    .replace(/√∂/g,'oe')
    .replace(/√º/g,'ue')
    .replace(/√ü/g,'ss');
}

/* ============================================================
   PUZZLE START
============================================================ */
let draggedTile = null;

function startPuzzle(){
  document.getElementById("mainCard").style.display="none";
  document.getElementById("puzzleOverlay").style.display="flex";

  const slots = document.getElementById("puzzleSlots");
  slots.innerHTML = "";

  for(let i = 0; i < 12; i++){
    const box = document.createElement("div");
    box.className = "slot";
    box.dataset.index = i;

    box.addEventListener("dragover", allowDrop);
    box.addEventListener("drop", dropIntoSlot);

    slots.appendChild(box);
  }

  const letters = [...collectedLetters];
  letters.sort(()=> Math.random() - 0.5);

  const pool = document.getElementById("puzzleLetters");
  pool.innerHTML = "";

  letters.forEach(L => createTile(L, pool));

  pool.addEventListener("dragover", allowDrop);
  pool.addEventListener("drop", dropIntoPool);
}

/* TILE ERSTELLEN */
function createTile(letter, parent){
  const t = document.createElement("div");
  t.className = "letterTile";
  t.textContent = letter;
  t.dataset.letter = letter;
  t.draggable = true;

  t.addEventListener("dragstart", dragStart);
  t.addEventListener("dragend", dragEnd);

  parent.appendChild(t);
}

/* DRAG + DROP */
function dragStart(){
  draggedTile = this;
  this.style.opacity = "0.4";
}

function dragEnd(){
  this.style.opacity = "1";
  draggedTile = null;
}

function allowDrop(e){
  e.preventDefault();
}

function dropIntoSlot(e){
  e.preventDefault();
  if(!draggedTile) return;

  const letter = draggedTile.dataset.letter;

  if(this.textContent.trim() !== ""){
    const oldLetter = this.textContent.trim();
    createTile(oldLetter, document.getElementById("puzzleLetters"));
  }

  this.textContent = letter;
  draggedTile.remove();

  checkSolved();
}

function dropIntoPool(e){
  e.preventDefault();
  if(!draggedTile) return;

  const pool = document.getElementById("puzzleLetters");
  const letter = draggedTile.dataset.letter;

  document.querySelectorAll(".slot").forEach(slot=>{
    if(slot.textContent.trim() === letter){
      slot.textContent = "";
    }
  });

  createTile(letter, pool);
  draggedTile.remove();

  checkSolved();
}

/* ============================================================
   PR√úFEN OB PUZZLE GEL√ñST IST
============================================================ */
function checkSolved(){
  const word = [...document.querySelectorAll(".slot")]
               .map(s => s.textContent.trim())
               .join("");

  if(word.length !== 12) return;

  if(word === "WINTERWUNDER"){
    setTimeout(()=>{
      document.getElementById("puzzleOverlay").style.display="none";
      document.getElementById("finalOverlay").style.display="flex";
    }, 300);
  } else {
    setTimeout(resetPuzzle, 500);
  }
}

/* RESET */
function resetPuzzle(){
  const pool = document.getElementById("puzzleLetters");
  pool.innerHTML = "";

  document.querySelectorAll(".slot").forEach(slot=>{
    const letter = slot.textContent.trim();
    if(letter !== ""){
      createTile(letter, pool);
      slot.textContent = "";
    }
  });
}
</script>
