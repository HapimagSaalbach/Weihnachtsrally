<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Der letzte Weihnachtszauber</title>

<style>
:root{
  --rot:#d61f3f;--rot-d:#b91c1c;--weiss:#fff;--weiss2:#fff9fa;--text:#1b1b1b;
  --muted:#7f1d1d;--ok:#16a34a;--err:#dc2626;--shadow:0 18px 50px rgba(0,0,0,.25);
  --radius:22px;
}

/* Hintergrund */
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

  background-image:url("Winterlandschaft.jpg");
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center top;
  background-color:#e6f3ff;

  min-height:100vh;
  display:grid;
  place-items:center;
  padding:16px;
  color:var(--text);
}

/* Hapimag Logo */
#hapilogo{
  position:fixed;
  top:10px;
  right:10px;
  width:140px;
  opacity:0.9;
  z-index:9999;
}

.wrap{width:min(980px,100%)}
.card{
  background:linear-gradient(180deg,var(--weiss2),#fff);
  border:1px solid #ffd6dc;
  border-radius:22px;
  box-shadow:var(--shadow);
  padding:18px;
  position:relative;
  overflow:hidden;
}

.head{
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:12px;
  align-items:center;
}
.title{
  font-size:clamp(1.4rem,2vw,2rem);
  color:var(--rot-d);
  margin:0;
}
.sub{
  color:#7f1d1d;
  margin:4px 0;
}
.badge{
  display:inline-block;
  padding:4px 12px;
  background:#fff5f6;
  border:1px solid #ffc7d0;
  border-radius:999px;
}

h2{color:#a0102a;margin-top:12px;}
input{
  width:100%;
  padding:.9rem 1rem;
  border:2px solid #ffd3da;
  border-radius:12px;
  margin-top:.4rem;
}
button{
  padding:.85rem 1.2rem;
  border-radius:12px;
  cursor:pointer;
  border:2px solid #e11d48;
  background:linear-gradient(180deg,#ff677d,#e11d48);
  color:white;
  font-weight:700;
}
button.secondary{
  background:white;
  color:#b91c1c;
  border-color:#ffc7d0;
}
.err{
  display:none;
  color:var(--err);
  font-weight:600;
  margin-top:.6rem;
}
.ok{
  display:none;
  margin-top:.6rem;
  background:#f0fdf4;
  border:2px solid #86efac;
  color:#065f46;
  padding:.8rem;
  border-radius:12px;
}
.loc{
  display:none;
  margin-top:.6rem;
  background:#f0fff4;
  border:2px solid #b5e7cd;
  padding:.9rem;
  border-radius:12px;
  font-weight:600;
}

/* POPUP */
.fullOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99999;
}

.popupBox{
  width:min(90%,480px);
  background:white;
  border-radius:20px;
  padding:22px;
  text-align:center;
  box-shadow:var(--shadow);
}

.popup-zirbel{
  width:180px;
  display:block;
  margin:auto;
}

/* Puzzle */
.puzzleBox{
  width:min(900px,92%);
  background:white;
  border-radius:22px;
  padding:26px;
  text-align:center;
}
.puzzleSlots,.puzzleLetters{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:20px;
}
.slot,.letterTile{
  width:60px;
  height:60px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.8rem;
  font-weight:800;
}
.slot{
  border:2px dashed #bfe8cf;
  color:#1f6f49;
  background:#f8fffb;
}
.letterTile{
  background:#d61f3f;
  color:white;
  cursor:grab;
}

/* Mobile */
@media(max-width:600px){
  .slot,.letterTile{
    width:70px;
    height:70px;
    font-size:2rem;
  }
}
</style>
</head>

<body>

<!-- Hapimag Logo -->
<img id="hapilogo" src="Hapimag Logo.png">
<main class="wrap">
  <section class="card">

    <!-- INTRO -->
    <div id="introOverlay" class="fullOverlay">
      <div class="popupBox" style="max-width:700px;">
        <h2>Der letzte Weihnachtszauber</h2>

        <p style="text-align:left;">
          In der l√§ngsten Nacht des Winters liegt das alte Haus still im Schnee ‚Äì und doch scheint es zu atmen.
          Drinnen flackert ein schwaches Licht, als w√ºrde jemand warten. Vor langer Zeit verga√ü das Christkind hier ein letztes Geschenk.
          Eine Truhe, versiegelt mit einem Zahlencode, den selbst der Himmel nicht mehr kennt. Seit jener Nacht ruht der Weihnachtszauber in ihr ‚Äì unerweckt, unerl√∂st.
          <br><br>
          Doch das Haus ist nicht stumm. Es fl√ºstert R√§tsel durch seine Flure, l√§sst Schatten tanzen und Kerzen flackern, als wollten sie f√ºhren.
          Wer genau hinh√∂rt, sp√ºrt, dass die Antworten √ºberall verborgen sind ‚Äì im Knirschen des Schnees, im Wispern des Windes, in Zeichen, die nur im rechten Moment sichtbar werden.
          <br><br>
          Drei Ziffern √∂ffnen die Truhe. Zw√∂lf schwere R√§tsel f√ºhren dorthin.
          Folge dem Ruf der Nacht, lausche den Hinweisen ‚Äì und vielleicht wirst du das Geschenk finden, das das Christkind selbst vergessen hat.
        </p>

        <button id="introStart">Weiter zur R√§tseltour ‚ú®</button>
      </div>
    </div>

    <!-- HEADER -->
    <header class="head">
      <img src="Weihnachtmann.png" style="width:60px">
      <div>
        <h1 class="title">Der letzte Weihnachtszauber</h1>
        <p class="sub">Sammle alle 12 Buchstaben ‚Äì am Ende entsteht das L√∂sungswort!</p>
        <span class="badge" id="badge"></span>
      </div>
      <img src="Weihnachtmann.png" style="width:60px">
    </header>

    <h2 id="riddleTitle">R√§tsel</h2>
    <p id="riddleText"></p>

    <label>Deine Antwort</label>
    <input id="answerInput">

    <button id="checkAnswerBtn" style="margin-top:1rem;">Antwort pr√ºfen</button>

    <div class="err" id="errBox">Leider falsch ‚Äì versuch's nochmal!</div>
    <div class="ok" id="okBox">Richtig!</div>

    <div id="locBox" class="loc"></div>

    <div id="letterStep" style="display:none;">
      <label>Buchstabe vom Ort</label>
      <input id="letterInput" maxlength="1">
    </div>

  </section>
</main>

<!-- POPUP -->
<div id="letterPopup" class="fullOverlay" style="display:none;">
  <div class="popupBox">
    <img src="Weihnachtsmann.png" class="popup-zirbel">
    <h2>Super! üéÑ‚ú®</h2>
    <p id="popupText">Du hast einen Buchstaben gefunden!</p>
    <button id="popupNextBtn">Weiter</button>
  </div>
</div>

<!-- PUZZLE -->
<div id="puzzleOverlay" class="fullOverlay" style="display:none;">
  <div class="puzzleBox">
    <h2>Buchstaben sortieren</h2>
    <p>Ziehe die Buchstaben in die richtige Reihenfolge.</p>
    <div class="puzzleSlots" id="puzzleSlots"></div>
    <div class="puzzleLetters" id="puzzleLetters"></div>
  </div>
</div>

<!-- FINALE -->
<div id="finalOverlay" class="fullOverlay" style="display:none;">
  <div class="popupBox">
    <img src="Weihnachtsmann.png" class="popup-zirbel">
    <h2>Du hast es geschafft! üéÅ</h2>
    <p>Gib das L√∂sungswort an der Rezeption ab.</p>
    <button onclick="location.reload()">Nochmal spielen</button>
  </div>
</div>
<script>
let currentStation=1;
let collectedLetters=[];
let currentLevel=1;

/* R√ÑTSEL */
const riddles=[
  {q:"Ich z√§hle Wochen bis zur Nacht ‚Ä¶ wer darf auf eurem Tisch stehen?", a:["adventskranz"]},
  {q:"Ein Zweig, der K√ºsse bringt ‚Ä¶ wie hei√ü' ich?", a:["mistel","mistelzweig"]},
  {q:"Ich ziehe den Schlitten durch die Nacht ‚Ä¶", a:["rentier"]},
  {q:"Ich fliege ohne Fl√ºgel den Hang hinunter ‚Ä¶", a:["schlitten","rodel"]},
  {q:"Sechs Zacken, s√º√ü gew√ºrzt ‚Ä¶", a:["zimtstern"]},
  {q:"Honig, Nelken, Marktst√§nde ‚Ä¶", a:["lebkuchen"]},
  {q:"Rote Bl√§tter, wei√üe Sterne ‚Ä¶", a:["weihnachtsstern"]},
  {q:"Stroh, Kind, Holzfiguren ‚Ä¶", a:["krippe"]},
  {q:"Ich funkle rund am Baum ‚Ä¶", a:["kugel","christbaumkugel"]},
  {q:"Ich komme am 6.12. ‚Ä¶", a:["nikolaus"]},
  {q:"Ich wies den K√∂nigen den Weg ‚Ä¶", a:["stern von bethlehem","bethlehemstern"]},
  {q:"Der Abend, an dem die Glocken leise werden ‚Ä¶", a:["heiligabend","heilige nacht"]}
];

/* ORTE + BUCHSTABEN (WINTERWUNDER gemischt) */
const lettersMapped=[
  null,
  {place:"B√ºcherecke", letter:"N"},
  {place:"Skikeller", letter:"R"},
  {place:"Honesty Shop", letter:"E"},
  {place:"M√ºllraum", letter:"W"},
  {place:"Sauna", letter:"U"},
  {place:"Oberstes Stockwerk", letter:"D"},
  {place:"Wohnungst√ºr 11", letter:"T"},
  {place:"Au√üeneingang Skikeller", letter:"I"},
  {place:"Weihnachtsbaum", letter:"N"},
  {place:"Wohnungst√ºr 35", letter:"W"},
  {place:"Eingang Heizkeller", letter:"E"},
  {place:"Rezeption", letter:"R"}
];

/* START */
document.getElementById("introStart").onclick=()=>{
  document.getElementById("introOverlay").style.display="none";
  loadStation(1);
};

/* LADEN */
function loadStation(n){
  currentStation=n;
  if(n>12){ startPuzzle(); return; }

  let r=riddles[n-1];
  document.getElementById("badge").textContent=`Station ${n} / 12`;
  document.getElementById("riddleText").textContent=r.q;

  document.getElementById("answerInput").value="";
  document.getElementById("letterInput").value="";
  document.getElementById("errBox").style.display="none";
  document.getElementById("okBox").style.display="none";
  document.getElementById("locBox").style.display="none";
  document.getElementById("letterStep").style.display="none";
}

/* ANTWORT PR√úFEN */
document.getElementById("checkAnswerBtn").onclick=()=>{
  let val=normalize(document.getElementById("answerInput").value);
  let ok=riddles[currentStation-1].a.some(a=>normalize(a)===val);

  if(!ok){
    document.getElementById("errBox").style.display="block";
    return;
  }

  document.getElementById("errBox").style.display="none";
  document.getElementById("okBox").style.display="block";

  const st=lettersMapped[currentStation];
  document.getElementById("locBox").innerHTML=
    `üìç <b>Ort:</b> ${st.place}<br>Suche dort den Buchstaben!`;
  document.getElementById("locBox").style.display="block";
  document.getElementById("letterStep").style.display="block";
};

/* BUCHSTABE PR√úFEN */
document.getElementById("letterInput").addEventListener("input",()=>{
  let val=document.getElementById("letterInput").value.trim().toUpperCase();
  let needed=lettersMapped[currentStation].letter;

  if(val===needed){
    collectedLetters.push(val);
    document.getElementById("letterPopup").style.display="flex";
  }
});

document.getElementById("popupNextBtn").onclick=()=>{
  document.getElementById("letterPopup").style.display="none";
  loadStation(currentStation+1);
};

/* PUZZLE */
function startPuzzle(){
  document.querySelector(".card").style.display="none";
  document.getElementById("puzzleOverlay").style.display="flex";

  const slots=document.getElementById("puzzleSlots");
  const pool=document.getElementById("puzzleLetters");

  slots.innerHTML="";
  pool.innerHTML="";

  for(let i=0;i<12;i++){
    let s=document.createElement("div");
    s.className="slot";
    slots.appendChild(s);
  }

  let mix=[...collectedLetters];
  mix.sort(()=>Math.random()-0.5);

  mix.forEach(l=>{
    let t=document.createElement("div");
    t.className="letterTile";
    t.textContent=l;
    pool.appendChild(t);

    t.onclick=()=>tryPlace(t);
  });
}

function tryPlace(tile){
  let empty=[...document.querySelectorAll(".slot")].find(s=>s.textContent==="");
  if(!empty)return;
  empty.textContent=tile.textContent;
  tile.remove();
  checkSolved();
}

function checkSolved(){
  let word=[...document.querySelectorAll(".slot")]
            .map(s=>s.textContent)
            .join("");

  if(word.length<12)return;

  if(word==="WINTERWUNDER"){
    document.getElementById("puzzleOverlay").style.display="none";
    document.getElementById("finalOverlay").style.display="flex";
  }else{
    resetPuzzle();
  }
}

function resetPuzzle(){
  let pool=document.getElementById("puzzleLetters");
  pool.innerHTML="";
  document.querySelectorAll(".slot").forEach(s=>{
    if(s.textContent!==""){
      let t=document.createElement("div");
      t.className="letterTile";
      t.textContent=s.textContent;
      pool.appendChild(t);
      t.onclick=()=>tryPlace(t);
      s.textContent="";
    }
  });
}

function normalize(s){
  return s.toLowerCase().trim()
    .replace(/√§/g,"ae").replace(/√∂/g,"oe")
    .replace(/√º/g,"ue").replace(/√ü/g,"ss");
}
</script>

</body>
</html>
